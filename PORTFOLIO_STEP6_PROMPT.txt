Step 6: 포트폴리오 공유 기능 구현 - 포트폴리오 공유 URL 생성, 공유 통계, 공유 조회 API 구현

현재 상황:

- Step 5 완료: 포트폴리오 조회/관리 API 구현 완료
- 포트폴리오 데이터 준비: 포트폴리오 생성 및 조회 가능
- 공유 기능 필요: 포트폴리오를 공유하고 통계를 관리할 수 있는 기능 필요


목표:

포트폴리오 공유 기능 구현
- 포트폴리오 공유 URL 생성
- 공유 통계 관리 (share_count)
- 공유된 포트폴리오 조회 API
- 공유 상태 업데이트
- 공유 메타데이터 생성 (OG 태그 등, 선택적)


검증 항목:

1. 포트폴리오 공유 URL 생성
   - POST /api/portfolio/<portfolio_id>/share/ 엔드포인트 확인
   - 공유 URL 생성 (예: /portfolio/<portfolio_id>/)
   - share_url 필드 업데이트
   - status를 'shared'로 변경
   - share_count 증가

2. 공유 통계 관리
   - share_count 필드 업데이트
   - 공유 시마다 share_count 증가
   - 공유 통계 조회 가능

3. 공유된 포트폴리오 조회 API
   - 공유 URL로 포트폴리오 조회 가능
   - 로그인 없이도 조회 가능 (공유 링크)
   - 공유 메타데이터 포함 (선택적)

4. 공유 상태 업데이트
   - status를 'shared'로 변경
   - share_url 저장
   - 공유 일시 기록 (선택적)

5. 공유 메타데이터 생성 (선택적)
   - OG 태그 생성 (Open Graph)
   - 공유 제목, 설명, 이미지 등
   - 카카오톡 공유용 메타데이터


관련 파일:

- api/views.py
  - portfolio_share_view() 함수
  - portfolio_detail_view() 함수 (공유 링크로 조회)

- api/models.py
  - Portfolio 모델
  - share_url 필드
  - share_count 필드
  - status 필드

- api/services/portfolio_service.py
  - share_portfolio() 함수
  - get_shared_portfolio() 함수


작업:

1. 포트폴리오 공유 API 확인/개선:
   - portfolio_share_view() 함수 확인
   - 공유 URL 생성 로직 확인
   - share_url 필드 업데이트 확인
   - status 업데이트 확인
   - share_count 증가 확인

2. 공유 통계 관리 구현:
   - share_count 필드 업데이트
   - 공유 시마다 share_count 증가
   - 공유 통계 조회 기능 추가

3. 공유된 포트폴리오 조회 API 구현:
   - 공유 URL로 포트폴리오 조회 가능하도록 구현
   - 로그인 없이도 조회 가능
   - 공유 메타데이터 포함 (선택적)

4. 공유 상태 업데이트 구현:
   - status를 'shared'로 변경
   - share_url 저장
   - 공유 일시 기록 (선택적)

5. 공유 메타데이터 생성 구현 (선택적):
   - OG 태그 생성
   - 공유 제목, 설명, 이미지 생성
   - 카카오톡 공유용 메타데이터 생성


검증 방법:

1. 포트폴리오 공유 테스트:
   ```python
   def test_portfolio_share():
       """포트폴리오 공유 테스트"""
       portfolio_id = "PF-TEST01"
       
       # 공유 전 상태 확인
       portfolio = Portfolio.objects.get(portfolio_id=portfolio_id)
       initial_count = portfolio.share_count
       
       # 공유
       response = client.post(f'/api/portfolio/{portfolio_id}/share/')
       assert response.status_code == 200
       data = response.json()
       
       assert data['success'] == True
       assert 'share_url' in data
       assert data['share_count'] == initial_count + 1
       
       # 상태 확인
       portfolio.refresh_from_db()
       assert portfolio.status == 'shared'
       assert portfolio.share_url == data['share_url']
       assert portfolio.share_count == initial_count + 1
       
       print(f"✅ 포트폴리오 공유 성공: {data['share_url']}")
   ```

2. 공유 통계 관리 테스트:
   ```python
   def test_share_count():
       """공유 통계 관리 테스트"""
       portfolio_id = "PF-TEST01"
       
       portfolio = Portfolio.objects.get(portfolio_id=portfolio_id)
       initial_count = portfolio.share_count
       
       # 여러 번 공유
       for i in range(3):
           client.post(f'/api/portfolio/{portfolio_id}/share/')
       
       portfolio.refresh_from_db()
       assert portfolio.share_count == initial_count + 3
       print(f"✅ 공유 통계 관리 확인: {portfolio.share_count}회")
   ```

3. 공유된 포트폴리오 조회 테스트:
   ```python
   def test_shared_portfolio_retrieval():
       """공유된 포트폴리오 조회 테스트"""
       portfolio_id = "PF-TEST01"
       
       # 공유
       share_response = client.post(f'/api/portfolio/{portfolio_id}/share/')
       share_url = share_response.json()['share_url']
       
       # 공유 URL로 조회 (로그인 없이)
       # share_url 형식: /portfolio/PF-TEST01/
       portfolio_path = share_url.split('/')[-2]  # portfolio_id 추출
       response = client.get(f'/api/portfolio/{portfolio_path}/')
       
       assert response.status_code == 200
       data = response.json()
       assert data['portfolio']['portfolio_id'] == portfolio_id
       
       print("✅ 공유된 포트폴리오 조회 성공")
   ```

4. 공유 상태 업데이트 테스트:
   ```python
   def test_share_status_update():
       """공유 상태 업데이트 테스트"""
       portfolio_id = "PF-TEST01"
       
       portfolio = Portfolio.objects.get(portfolio_id=portfolio_id)
       assert portfolio.status != 'shared'
       
       # 공유
       client.post(f'/api/portfolio/{portfolio_id}/share/')
       
       portfolio.refresh_from_db()
       assert portfolio.status == 'shared'
       assert portfolio.share_url is not None
       
       print("✅ 공유 상태 업데이트 확인")
   ```

5. 공유 메타데이터 생성 테스트 (선택적):
   ```python
   def test_share_metadata():
       """공유 메타데이터 생성 테스트"""
       portfolio_id = "PF-TEST01"
       
       response = client.post(f'/api/portfolio/{portfolio_id}/share/')
       data = response.json()
       
       # 공유 메타데이터 확인
       assert 'share_metadata' in data or 'og_tags' in data
       
       if 'share_metadata' in data:
           metadata = data['share_metadata']
           assert 'title' in metadata
           assert 'description' in metadata
           assert 'image' in metadata
           
           print("✅ 공유 메타데이터 생성 확인")
   ```


예상 결과:

1. 포트폴리오 공유:
   - 공유 URL 정상 생성
   - share_url 필드 정상 업데이트
   - status 정상 업데이트 ('shared')
   - share_count 정상 증가

2. 공유 통계 관리:
   - share_count 정상 업데이트
   - 공유 시마다 share_count 증가
   - 공유 통계 정상 조회

3. 공유된 포트폴리오 조회:
   - 공유 URL로 정상 조회
   - 로그인 없이도 조회 가능
   - 공유 메타데이터 포함 (선택적)

4. 공유 상태 업데이트:
   - status 정상 업데이트
   - share_url 정상 저장
   - 공유 일시 기록 (선택적)

5. 공유 메타데이터 생성:
   - OG 태그 정상 생성 (선택적)
   - 공유 제목, 설명, 이미지 정상 생성 (선택적)


테스트 스크립트 구조:

```python
class PortfolioShareValidator:
    """포트폴리오 공유 기능 검증 클래스"""
    
    def validate_all(self):
        """모든 검증 실행"""
        # 1. 포트폴리오 공유
        # 2. 공유 통계 관리
        # 3. 공유된 포트폴리오 조회
        # 4. 공유 상태 업데이트
        # 5. 공유 메타데이터 생성
    
    def _test_portfolio_share(self):
        """포트폴리오 공유 테스트"""
    
    def _test_share_count(self):
        """공유 통계 관리 테스트"""
    
    def _test_shared_portfolio_retrieval(self):
        """공유된 포트폴리오 조회 테스트"""
    
    def _test_share_status_update(self):
        """공유 상태 업데이트 테스트"""
    
    def _test_share_metadata(self):
        """공유 메타데이터 생성 테스트"""
```


시각화 항목:

1. 포트폴리오 공유 플로우 다이어그램
2. 공유 통계 분포
3. 공유 횟수 분포
4. 공유 상태 분포
5. 공유 메타데이터 생성 성공률 (선택적)


참고:

- 공유 URL은 간단하고 기억하기 쉬운 형식으로 생성
- 공유된 포트폴리오는 로그인 없이도 조회 가능해야 함
- 공유 메타데이터는 카카오톡, 페이스북 등 SNS 공유에 활용
- Step 7에서 상담 예약 연동 기능을 구현할 예정

