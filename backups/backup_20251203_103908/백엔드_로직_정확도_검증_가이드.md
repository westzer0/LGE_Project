# 백엔드 로직 정확도 검증 가이드

## 📋 개요

추천 엔진의 정확도를 확인하고 분석하는 도구입니다.

## 🛠️ 사용 방법

### 1. 기본 정확도 테스트

```bash
python manage.py test_recommendation_accuracy
```

**기본 시나리오 테스트:**
- 1인 가구 - 저예산
- 4인 가족 - 중예산
- 프리미엄 가구 - 고예산
- 반려동물 있는 가구

**출력 예시:**
```
=== 테스트 결과 요약 ===
전체 테스트: 4개
통과: 4개
실패: 0개
정확도: 100.0%
```

### 2. 상세 테스트 (모든 시나리오)

```bash
python manage.py test_recommendation_accuracy --scenario all --verbose
```

**옵션:**
- `--scenario`: `basic` (기본), `all` (전체), `edge` (엣지 케이스)
- `--verbose`: 상세한 결과 출력

**출력 내용:**
- 각 테스트의 통과/실패 여부
- 추천된 제품 목록
- 점수 범위 및 평균
- 검증 체크리스트

### 3. 추천 결과 분석

```bash
python manage.py analyze_recommendations
```

**기본 분석:**
- 데이터베이스 통계
- 샘플 추천 분석 (50개)
- 점수 분포 분석

**옵션:**
```bash
# 샘플 수 조정
python manage.py analyze_recommendations --sample-size 100

# 특정 카테고리만 분석
python manage.py analyze_recommendations --category TV
```

**출력 내용:**
- 성공률
- 평균 추천 개수
- 평균 점수
- 점수 분포 (높음/중간/낮음)
- 가격 분포 (저예산/중예산/고예산)
- 카테고리 분포

## 📊 검증 항목

### 1. 필터링 정확도
- ✅ 예산 범위 내 제품만 추천
- ✅ 선택한 카테고리만 추천
- ✅ 반려동물 없으면 펫 제품 제외
- ✅ 가족 구성에 맞는 용량 추천

### 2. 스코어링 정확도
- ✅ 점수가 0~1 범위 내
- ✅ 점수 내림차순 정렬
- ✅ 가족 구성원 수에 따른 용량 점수
- ✅ 카테고리별 가중치 적용

### 3. 결과 품질
- ✅ 최소 1개 이상 추천
- ✅ 추천 이유 제공
- ✅ 제품 정보 완전성

## 🔍 테스트 시나리오 상세

### 기본 시나리오

1. **1인 가구 - 저예산**
   - 예산: 50만원 이하
   - 카테고리: TV, LIVING
   - 검증: 작은 용량 제품 우선, 펫 제품 제외

2. **4인 가족 - 중예산**
   - 예산: 50만원 ~ 200만원
   - 카테고리: TV, KITCHEN, LIVING
   - 검증: 대용량 제품 우선

3. **프리미엄 가구 - 고예산**
   - 예산: 200만원 이상
   - 카테고리: TV, KITCHEN
   - 검증: 고가 제품 추천

4. **반려동물 있는 가구**
   - 카테고리: LIVING
   - 검증: 펫 제품 허용

### 엣지 케이스

1. **예산 범위 밖**
   - 매우 낮은 예산
   - 검증: 에러 없이 처리

2. **카테고리 없음**
   - 빈 카테고리 리스트
   - 검증: 에러 없이 처리

## 📈 결과 해석

### 정확도 100%
- 모든 테스트 통과
- 추천 로직이 정상 작동

### 정확도 80% 이상
- 대부분의 케이스 정상
- 일부 엣지 케이스 개선 필요

### 정확도 80% 미만
- 주요 로직에 문제 가능
- 로그 확인 및 디버깅 필요

### 점수 분포 분석

**이상적인 분포:**
- 높음 (0.8 이상): 30~50%
- 중간 (0.5 ~ 0.8): 40~60%
- 낮음 (0.5 미만): 10% 이하

**문제가 있는 경우:**
- 모든 점수가 낮음: 스코어링 로직 점검
- 모든 점수가 높음: 필터링이 너무 약함
- 점수 차이가 없음: 가중치 조정 필요

## 🐛 문제 해결

### 추천이 안 나오는 경우
1. 데이터베이스에 제품이 있는지 확인
2. 스펙 데이터가 있는지 확인
3. 필터링 조건이 너무 엄격한지 확인

### 점수가 이상한 경우
1. `api/utils/scoring.py`의 가중치 확인
2. 스펙 데이터 형식 확인
3. 점수 계산 로직 디버깅

### 필터링이 작동하지 않는 경우
1. `api/services/recommendation_engine.py`의 `_filter_products` 확인
2. 예산 매핑 확인
3. 카테고리 필터 확인

## 💡 추가 개선 사항

### 로깅 추가
```python
import logging
logger = logging.getLogger(__name__)

# 추천 과정 로깅
logger.info(f"User profile: {user_profile}")
logger.info(f"Filtered products: {filtered_products.count()}")
logger.info(f"Top scores: {[r['score'] for r in top_products]}")
```

### 성능 모니터링
- 추천 소요 시간 측정
- 데이터베이스 쿼리 최적화
- 캐싱 적용

### A/B 테스트
- 다른 가중치 조합 테스트
- 필터링 규칙 비교
- 사용자 만족도 측정

## 📝 예제 출력

```
=== 추천 엔진 정확도 테스트 ===

=== 테스트 결과 요약 ===
전체 테스트: 4개
통과: 4개
실패: 0개
정확도: 100.0%

=== 상세 결과 ===

✓ 1인 가구 - 저예산
  추천 개수: 3
  상위 추천 제품:
    1. LG OLED48C4ENA (점수: 0.852, 가격: 450,000원)
    2. LG 냉장고 200L (점수: 0.734, 가격: 380,000원)
    3. LG 세탁기 7kg (점수: 0.691, 가격: 320,000원)
  점수 범위: 0.691 ~ 0.852 (평균: 0.759)
  검증 결과:
    ✓ success: True
    ✓ has_recommendations: True
    ✓ price_within_max: True
    ✓ min_count_met: True
    ✓ no_pet_products: True
    ✓ scores_valid: True
    ✓ scores_sorted: True
```

## 🔗 관련 파일

- `api/services/recommendation_engine.py`: 추천 엔진 메인 로직
- `api/utils/scoring.py`: 스코어링 로직
- `api/management/commands/test_recommendation_accuracy.py`: 정확도 테스트
- `api/management/commands/analyze_recommendations.py`: 결과 분석

