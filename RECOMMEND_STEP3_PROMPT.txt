Step 3: 카테고리별 제품 조회 로직 검증 - 선택된 카테고리로 제품을 조회하는 로직 검증


현재 상황:

- Step 1 완료: 추천 엔진 인프라 확인 완료
- Step 2 완료: Taste 기반 카테고리 선택 로직 검증 완료 (Taste ID → 카테고리 매핑 확인)
- 카테고리별로 제품 조회가 가능한지 확인 필요


목표:

선택된 카테고리로부터 제품을 조회하는 로직이 올바르게 작동하는지 검증
- 카테고리 ID로 제품 조회 기능 검증
- 여러 카테고리에서 제품 조회 시 처리 확인
- 제품 정렬 및 제한 로직 확인


검증 항목:

1. 카테고리별 제품 조회 기능 검증
   - 카테고리 ID를 입력받아 제품 목록을 반환하는 함수 존재 여부 확인
   - 조회된 제품이 해당 카테고리에 속하는지 확인
   - 제품 데이터의 완전성 확인 (필수 필드 존재)

2. 여러 카테고리 처리 검증
   - 여러 카테고리 ID를 입력받아 제품을 조회하는 경우 처리 확인
   - 중복 제품 제거 로직 확인
   - 카테고리별 제품 수 확인

3. 제품 정렬 로직 검증
   - 제품이 어떤 기준으로 정렬되는지 확인 (인기순, 가격순, 최신순 등)
   - 정렬 로직이 올바르게 작동하는지 확인

4. 제품 제한 로직 검증
   - 상위 N개 제품만 선택하는 로직 확인
   - 제한 개수가 올바르게 적용되는지 확인

5. 실제 카테고리 데이터로 검증
   - Step 2에서 선택된 실제 카테고리로 제품 조회 테스트
   - 조회된 제품이 존재하는지 확인
   - 각 카테고리별 제품 수 확인

6. 빈 결과 처리 검증
   - 제품이 없는 카테고리 처리 확인
   - 빈 카테고리 리스트 처리 확인

7. 성능 검증
   - 카테고리별 제품 조회 속도 확인
   - 여러 카테고리 동시 조회 성능 확인


관련 파일 (예상):

- api/services/recommendation_service.py
  - get_products_by_categories() 메서드 (예상)
  - 카테고리 ID 리스트를 입력받아 제품 목록 반환

- api/services/product_service.py (존재 여부 확인 필요)
  - 제품 조회 관련 서비스

- api/db/oracle_client.py
  - DB 쿼리 실행 함수


작업:

1. 카테고리별 제품 조회 함수 찾기:
   - 코드베이스에서 제품 조회 로직 검색
   - 카테고리 기반 제품 조회 함수/메서드 확인

2. 조회 로직 검증:
   - 단일 카테고리로 제품 조회 테스트
   - 여러 카테고리로 제품 조회 테스트
   - 조회된 제품 데이터 검증

3. 정렬 및 제한 로직 검증:
   - 정렬 기준 확인 및 테스트
   - 제한 개수 적용 확인

4. 실제 카테고리 데이터로 검증:
   - Step 2에서 선택된 실제 카테고리 사용
   - 각 카테고리별로 제품 조회
   - 조회 결과 검증

5. 성능 테스트:
   - 단일 카테고리 조회 시간 측정
   - 여러 카테고리 조회 시간 측정
   - 병목 구간 식별

6. 시각화 생성:
   - 카테고리별 제품 수 분포
   - 조회 성공/실패 비율
   - 조회 시간 분포


검증 방법:

1. 단일 카테고리 조회 테스트:
   ```python
   # 카테고리 ID로 제품 조회
   category_id = 1
   products = get_products_by_category(category_id)
   
   # 제품이 조회되었는지 확인
   assert len(products) > 0
   
   # 조회된 제품이 해당 카테고리에 속하는지 확인
   for product in products:
       assert product['category_id'] == category_id
       # 필수 필드 존재 확인
       assert 'product_id' in product
       assert 'name' in product
       assert 'price' in product
   ```

2. 여러 카테고리 조회 테스트:
   ```python
   # 여러 카테고리 ID로 제품 조회
   category_ids = [1, 2, 3]
   products = get_products_by_categories(category_ids)
   
   # 제품이 조회되었는지 확인
   assert len(products) > 0
   
   # 조회된 제품이 선택된 카테고리에 속하는지 확인
   for product in products:
       assert product['category_id'] in category_ids
   ```

3. 정렬 로직 테스트:
   ```python
   category_id = 1
   products = get_products_by_category(category_id, sort_by='price', limit=10)
   
   # 제한 개수 확인
   assert len(products) <= 10
   
   # 정렬 확인 (가격순인 경우)
   prices = [p['price'] for p in products]
   assert prices == sorted(prices)  # 오름차순 또는 내림차순 확인
   ```

4. 실제 카테고리 데이터 테스트:
   ```python
   # Step 2에서 선택된 카테고리 사용
   taste_id = 50
   categories = get_categories_for_taste(taste_id)
   
   # 각 카테고리별로 제품 조회
   all_products = []
   for category in categories:
       products = get_products_by_category(category['id'])
       all_products.extend(products)
       # 각 카테고리별 제품 수 확인
       print(f"Category {category['id']}: {len(products)} products")
   ```

5. 빈 결과 처리 테스트:
   ```python
   # 제품이 없는 카테고리 (존재하지 않거나 제품이 0개)
   empty_category_id = 999
   products = get_products_by_category(empty_category_id)
   
   # 빈 리스트 반환 또는 적절한 처리 확인
   assert isinstance(products, list)
   # 에러가 발생하지 않아야 함
   ```


예상 결과:

1. 카테고리별 제품 조회:
   - 모든 유효한 카테고리에 대해 제품 조회 성공
   - 조회된 제품이 해당 카테고리에 속함
   - 제품 데이터의 필수 필드 모두 존재

2. 여러 카테고리 처리:
   - 여러 카테고리로 제품 조회 성공
   - 중복 제품이 적절히 처리됨
   - 각 카테고리별 제품 수 확인 가능

3. 정렬 및 제한:
   - 정렬 기준에 따라 제품이 올바르게 정렬됨
   - 제한 개수가 올바르게 적용됨

4. 실제 데이터:
   - Step 2에서 선택된 모든 카테고리에 대해 제품 조회 성공
   - 각 카테고리별로 최소 1개 이상의 제품 존재

5. 성능:
   - 단일 카테고리 조회 시간 < 1초
   - 여러 카테고리 조회 시간 < 3초


테스트 스크립트 구조:

```python
class CategoryProductRetrievalValidator:
    """카테고리별 제품 조회 로직 검증 클래스"""
    
    def validate_all(self):
        """모든 검증 실행"""
        # 1. 카테고리별 제품 조회 기능 검증
        # 2. 여러 카테고리 처리 검증
        # 3. 제품 정렬 로직 검증
        # 4. 제품 제한 로직 검증
        # 5. 실제 카테고리 데이터로 검증
        # 6. 빈 결과 처리 검증
        # 7. 성능 검증
    
    def _validate_single_category_retrieval(self):
        """단일 카테고리 제품 조회 검증"""
    
    def _validate_multiple_categories_retrieval(self):
        """여러 카테고리 제품 조회 검증"""
    
    def _validate_sorting_logic(self):
        """제품 정렬 로직 검증"""
    
    def _validate_limit_logic(self):
        """제품 제한 로직 검증"""
    
    def _validate_with_real_categories(self):
        """실제 카테고리 데이터로 검증"""
        # Step 2에서 선택된 카테고리 사용
    
    def _validate_empty_results(self):
        """빈 결과 처리 검증"""
    
    def _measure_performance(self):
        """성능 측정"""
```


시각화 항목:

1. 카테고리별 제품 수 분포 바 차트
2. 조회 성공/실패 비율 파이 차트
3. 조회 시간 분포 히스토그램
4. 카테고리별 평균 제품 수
5. 제품 가격 분포 (카테고리별)


참고:

- Step 2에서 검증한 카테고리 선택 결과 활용
- 실제 제품 데이터로 테스트하여 현실성 확보
- 조회 성능은 이후 단계에서 중요할 수 있으므로 초기부터 확인
- 제품 정렬 기준은 비즈니스 요구사항에 따라 다를 수 있음

