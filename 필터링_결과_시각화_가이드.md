# 필터링 결과 시각화 가이드

## 📋 개요

온보딩 모든 케이스별로 필터링 전/후 제품 수와 제외된 제품을 시각화하는 도구입니다.

---

## 🚀 사용법

### 기본 사용 (전체 768개 케이스)

```bash
python manage.py visualize_filtering_results
```

### 처음 10개만 테스트

```bash
python manage.py visualize_filtering_results --limit 10
```

### 출력 파일 지정

```bash
python manage.py visualize_filtering_results --output my_report.html
```

### 특정 카테고리만 테스트

```bash
python manage.py visualize_filtering_results --categories TV KITCHEN
```

### 전체 옵션

```bash
python manage.py visualize_filtering_results \
    --csv-path data/온보딩/taste_recommendations_768.csv \
    --limit 100 \
    --output filtering_report.html \
    --categories TV KITCHEN LIVING
```

---

## 📊 리포트 내용

생성된 HTML 리포트에는 다음 정보가 포함됩니다:

### 1. 요약 통계
- 총 케이스 수
- 평균 필터링 전 제품 수
- 평균 필터링 후 제품 수
- 평균 제외된 제품 수

### 2. 필터별 제외 통계
- 가족 구성 (용량) 필터로 제외된 제품 수
- 주거 형태/평수 (크기) 필터로 제외된 제품 수
- 생활 패턴 필터로 제외된 제품 수
- 우선순위 필터로 제외된 제품 수

### 3. 필터링 효과 차트
- 필터링 전/후/제외된 수를 비교하는 바 차트
- 처음 20개 케이스 표시

### 4. 케이스별 상세 결과 테이블
각 케이스별로:
- taste_id
- 인테리어 스타일
- 가구 구성
- 우선순위
- 필터링 전 제품 수
- 필터링 후 제품 수
- 제외된 제품 수
- 추천된 제품 수
- 제외된 제품 목록 (제품명, 카테고리, 제외 이유)

---

## 📈 리포트 예시

### 요약 통계 예시

```
총 케이스 수: 768
평균 필터링 전 제품 수: 150
평균 필터링 후 제품 수: 45
평균 제외된 제품 수: 105
```

### 필터별 제외 통계 예시

```
가족 구성 (용량): 1,234개
주거 형태/평수 (크기): 567개
생활 패턴: 89개
우선순위: 123개
```

### 케이스별 상세 결과 예시

| taste_id | 인테리어 | 가구 구성 | 우선순위 | 필터링 전 | 필터링 후 | 제외된 수 | 추천 수 | 제외된 제품 |
|----------|----------|-----------|----------|-----------|-----------|-----------|---------|-------------|
| 1 | 모던 & 미니멀 | 1인 가구 | 디자인 | 150 | 45 | 105 | 3 | LG 트롬 21kg (가족 구성), LG 디오스 900L (주거 형태) ... |

---

## 🔍 리포트 분석 방법

### 1. 필터링 효과 확인
- **필터링 전/후 차이**: 필터링이 얼마나 효과적인지 확인
- **제외 비율**: 전체 제품 중 몇 %가 제외되었는지 확인

### 2. 필터별 영향도 확인
- 어떤 필터가 가장 많은 제품을 제외하는지 확인
- 필터 기준이 너무 엄격한지 확인

### 3. 케이스별 분석
- 특정 케이스에서 왜 많은 제품이 제외되었는지 확인
- 제외된 제품의 제외 이유 확인

### 4. 필터 기준 조정
- 리포트를 보고 필터 기준을 조정
- 예: "1인 가구에서 너무 많은 제품이 제외되면 용량 기준 완화"

---

## 🛠️ 문제 해결

### 리포트가 생성되지 않는 경우

1. **CSV 파일 경로 확인**
   ```bash
   # CSV 파일이 있는지 확인
   ls data/온보딩/taste_recommendations_768.csv
   ```

2. **데이터베이스 확인**
   ```bash
   # 제품 데이터가 있는지 확인
   python manage.py shell
   >>> from api.models import Product
   >>> Product.objects.count()
   ```

3. **에러 로그 확인**
   - 명령어 실행 시 에러 메시지 확인
   - `--limit 1`로 하나만 테스트

### 리포트가 너무 큰 경우

- `--limit` 옵션으로 케이스 수 제한
- 특정 카테고리만 테스트

### 성능 이슈

- 전체 768개 케이스는 시간이 오래 걸릴 수 있음
- `--limit` 옵션으로 점진적으로 테스트

---

## 📝 다음 단계

1. **전체 케이스 실행** (시간 소요)
   ```bash
   python manage.py visualize_filtering_results
   ```

2. **리포트 확인**
   - `filtering_visualization_report.html` 파일 열기
   - 브라우저에서 확인

3. **필터 기준 조정**
   - 리포트를 보고 필터 기준이 적절한지 확인
   - 필요시 `api/utils/product_filters.py` 수정

4. **재실행 및 비교**
   - 필터 기준 수정 후 재실행
   - 결과 비교

---

## 💡 활용 예시

### 예시 1: 필터링 효과 확인

```bash
# 처음 50개 케이스로 테스트
python manage.py visualize_filtering_results --limit 50

# 리포트에서 확인:
# - 평균 필터링 전: 150개
# - 평균 필터링 후: 45개
# - 필터링 효과: 70% 제외
```

### 예시 2: 특정 필터 영향도 확인

```bash
# 리포트의 "필터별 제외 통계" 섹션 확인
# - 가족 구성 필터: 1,234개 제외
# - 주거 형태 필터: 567개 제외
# → 가족 구성 필터가 가장 영향력이 큼
```

### 예시 3: 문제 케이스 찾기

```bash
# 리포트의 "케이스별 상세 결과" 테이블에서
# 제외된 수가 0인 케이스 찾기
# → 필터가 너무 약한 케이스
```

---

## 📚 관련 파일

- `api/management/commands/visualize_filtering_results.py`: 시각화 명령어
- `api/utils/product_filters.py`: 필터링 로직
- `api/services/recommendation_engine.py`: 추천 엔진
- `data/온보딩/taste_recommendations_768.csv`: 온보딩 케이스 데이터



